<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>CLOYZZI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  background:#000;
}
#overlay{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-family:Arial;
  letter-spacing:4px;
  cursor:pointer;
  z-index:10;
}
canvas{display:block}
</style>
</head>
<body>

<div id="overlay">CLICK TO ENTER</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>
let scene, camera, renderer, clock;
let analyser, dataArray;
let core, particles;

const overlay = document.getElementById("overlay");

overlay.onclick = async () => {
  overlay.remove();
  await startAudio();
  init();
  animate();
};

async function startAudio(){
  const audio = new Audio("music.mp3");
  audio.loop = true;
  audio.volume = 0.6;

  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const src = ctx.createMediaElementSource(audio);

  analyser = ctx.createAnalyser();
  analyser.fftSize = 256;

  src.connect(analyser);
  analyser.connect(ctx.destination);

  dataArray = new Uint8Array(analyser.frequencyBinCount);
  audio.play();
}

function init(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x050008);

  camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
  camera.position.z = 15;

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  clock = new THREE.Clock();

  scene.add(new THREE.AmbientLight(0xffffff, 0.7));
  const light = new THREE.PointLight(0xff00ff, 4, 100);
  light.position.set(0,0,20);
  scene.add(light);

  // CORE
  core = new THREE.Mesh(
    new THREE.IcosahedronGeometry(3.5, 3),
    new THREE.MeshStandardMaterial({
      color:0xffffff,
      metalness:1,
      roughness:0.05,
      emissive:0x440044,
      emissiveIntensity:2
    })
  );
  scene.add(core);

  // PARTICLES
  const g = new THREE.BufferGeometry();
  const count = 3000;
  const p = new Float32Array(count*3);
  for(let i=0;i<p.length;i++) p[i]=(Math.random()-0.5)*80;
  g.setAttribute("position", new THREE.BufferAttribute(p,3));
  particles = new THREE.Points(
    g,
    new THREE.PointsMaterial({color:0xffffff, size:0.5})
  );
  scene.add(particles);

  window.addEventListener("resize", ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });
}

function animate(){
  requestAnimationFrame(animate);

  analyser.getByteFrequencyData(dataArray);
  const bass = dataArray[2] / 255;

  core.rotation.x += 0.01 + bass*0.1;
  core.rotation.y += 0.015 + bass*0.15;
  core.scale.setScalar(1 + bass*0.7);

  particles.rotation.y += 0.002 + bass*0.05;

  renderer.render(scene, camera);
}
</script>
</body>
</html>
